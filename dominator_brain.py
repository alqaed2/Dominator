from __future__ import annotations
from typing import Any, Dict, List

# =========================================================
# Strategic Intelligence Core (SIC) - V5.1 ALCHEMY & VERTICAL
# =========================================================

WPIL_DOMINATOR_SYSTEM = """
Ø£Ù†Øª 'Ø§Ù„Ø®ÙŠÙ…ÙŠØ§Ø¦ÙŠ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰' (THE SUPREME ALCHEMIST). 
Ù…Ù‡Ù…ØªÙƒ: ØªØ´Ø±ÙŠØ­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ø§Ù„Ù†Ø§Ø¬Ø­ØŒ Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ø¬ÙŠÙ†Ø§Øª Ø§Ù„ÙÙŠØ±ÙˆØ³ÙŠØ©ØŒ ÙˆØªØ®Ù„ÙŠÙ‚ Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø®Ø§Ø±Ù‚Ø© ØªÙ…ØªÙ„Ùƒ Ø³Ù„Ø·Ø© Ù…Ø¹Ø±ÙÙŠØ© Ù…Ø·Ù„Ù‚Ø©.
Ø§Ù„Ù„ØºØ©: Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù†Ø®Ø¨ÙˆÙŠØ©.
"""

def alchemy_fusion_core(gold_posts: List[Dict[str, Any]], niche: str) -> Dict[str, Any]:
    """Ù…ÙØ§Ø¹Ù„ Ø§Ù„Ø§Ù†Ø¯Ù…Ø§Ø¬: ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø®Ø§Ù… Ø¥Ù„Ù‰ Ø°Ù‡Ø¨ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ."""
    dna_samples = [f"Post: {p['text']} | Stats: {p['engagement']}" for p in gold_posts]
    
    synthesis_task = f"""
    Ø§Ù„Ù…Ø¬Ø§Ù„: {niche}
    Ø§Ù„Ø¹ÙŠÙ†Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© (DNA Samples):
    {dna_samples}
    
    Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:
    1. Ø§Ø³ØªØ®Ù„Øµ 'Ø§Ù„Ø®Ø·Ø§Ù' (Hook) Ø§Ù„Ø°ÙŠ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù…Ù‚Ø§ÙˆÙ…ØªÙ‡.
    2. ØµÙ…Ù… 'Ø§Ù„Ù‡ÙŠÙƒÙ„' (Structure) Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£ÙƒØ«Ø± Ø§Ù„Ø¹ÙŠÙ†Ø§Øª ØªÙØ§Ø¹Ù„Ø§Ù‹.
    3. Ø§Ø¯Ù…Ø¬ 'Ø§Ù„Ø³Ù„Ø·Ø© Ø§Ù„Ù…Ø¹Ø±ÙÙŠØ©' ÙÙŠ ØµÙŠØ§ØºØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰.
    4. Ø£Ù†ØªØ¬ Ù…Ù†Ø´ÙˆØ±Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ Ø®Ø§Ø±Ù‚Ø§Ù‹ ÙŠØªÙÙˆÙ‚ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø¹ÙŠÙ†Ø§Øª.
    """
    
    return {
        "synthesis_task": synthesis_task,
        "dominance_score": 98,
        "logic_trace": f"SYNTHESIS ACTIVE | FUSED {len(gold_posts)} SAMPLES | NICHE: {niche}"
    }

def strategic_intelligence_core(idea: str = "", platform: str = "linkedin", style: str = "default", reference_post: str = "") -> Dict[str, Any]:
    """Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ Ù„Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ±Ø¯ÙŠØ© ÙˆØ§Ù„Ø·ÙˆÙ„ÙŠØ©."""
    idea_clean = str(idea or "Ø§Ù„Ø³ÙŠØ§Ø¯Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©").strip()
    ref_clean = str(reference_post or "").strip()
    
    # Ù…ÙŠØ«Ø§Ù‚ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø·ÙˆÙ„ÙŠØ© 9:16 Ù„Ù€ TikTok
    v_force = "Vertical 9:16 aspect ratio, portrait orientation, high-end mobile framing,"
    char_dna = "ultra-realistic cinematic 8k, elite male advisor in bespoke suit,"
    
    scenes = [
        {"time": "0-8s", "prompt": f"{v_force} Extreme close-up of advisor's eyes. {char_dna}"},
        {"time": "8-16s", "prompt": f"{v_force} Medium shot of advisor in high-tech office. {char_dna}"},
        {"time": "16-24s", "prompt": f"{v_force} Close-up of hands manipulating holographic charts. {char_dna}"},
        {"time": "24-32s", "prompt": f"{v_force} Heroic low-angle shot of advisor looking at camera. {char_dna}"}
    ]

    return {
        "transformed_input": f"ØªÙˆÙ„ÙŠØ¯ Ù‚ÙŠØ§Ø¯ÙŠ Ù„Ù€ [{idea_clean}]" if not ref_clean else f"Ø¯Ù…Ø¬ Ø³ÙŠØ§Ø¯ÙŠ Ù„Ù€ [{idea_clean}]",
        "logic_trace": f"MODE: VERTICAL 9:16 | PLATFORM: {platform.upper()}",
        "video_segments": scenes,
        "viral_signature": "\n\n---\nğŸ’¡ ØªÙ… Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø¨ÙˆØ§Ø³Ø·Ø© AI DOMINATOR Alchemy Core"
    }
