<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI DOMINATOR | V11 Production Studio</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>

    <div class="app-container">
        
        <header class="cyber-header">
            <div class="logo-section">
                <h1>AI DOMINATOR <span class="version-tag">V11.1 PRO</span></h1>
            </div>
            <div class="system-status">
                <div class="status-dot"></div>
                SYSTEM ONLINE
            </div>
        </header>

        <main class="dashboard-grid">
            
            <div class="sidebar">
                <div class="cyber-card">
                    <div class="card-title">
                        <h3><i class="fas fa-fingerprint"></i> Ø¨ØµÙ…Ø© Ø§Ù„Ø£Ø³Ù„ÙˆØ¨</h3>
                        <div class="tech-decor-line"></div>
                    </div>
                    <textarea id="sampleText" rows="3" placeholder=">_ Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..."></textarea>
                    <button onclick="analyzeStyle()" class="cyber-btn-small"><i class="fas fa-upload"></i> ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    <div id="styleStatus" class="status-text"></div>
                    <input type="hidden" id="styleDNA" value="">
                </div>

                <div class="cyber-card" style="margin-top: 25px;">
                    <div class="card-title">
                        <h3><i class="fas fa-sliders-h"></i> Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„ØµÙˆØ±Ø©</h3>
                        <div class="tech-decor-line"></div>
                    </div>
                    <select id="imageStyle">
                        <option value="Cyberpunk, Neon, Futurism, Cinematic Lighting">ğŸ”® Ø³Ø§ÙŠØ¨Ø± Ø¨Ø§Ù†Ùƒ Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ</option>
                        <option value="Cinematic Photorealistic, 8k, Highly Detailed">ğŸ“¸ ÙˆØ§Ù‚Ø¹ÙŠ Ø¬Ø¯Ø§Ù‹ (8K)</option>
                        <option value="3D Render, Unreal Engine 5 Style">ğŸ§Š 3D Ø±ÙŠÙ†Ø¯Ø± (Unreal)</option>
                        <option value="Minimalist Modern Tech Illustration">âœï¸ Ø±Ø³Ù… ØªÙ‚Ù†ÙŠ Ø­Ø¯ÙŠØ«</option>
                    </select>
                </div>
            </div>

            <div class="main-content">
                
                <div class="cyber-card">
                    <div class="card-title">
                        <h3><i class="fas fa-film"></i> Ø§Ø³ØªÙˆØ¯ÙŠÙˆ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ</h3>
                        <div class="tech-decor-line" style="width: 150px;"></div>
                    </div>
                    <textarea id="inputText" rows="3" placeholder=">_ Ø£Ø¯Ø®Ù„ ÙÙƒØ±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ/Ø§Ù„Ø­Ù…Ù„Ø© Ù‡Ù†Ø§..."></textarea>
                    <button id="generateBtn" class="cyber-btn-main" onclick="remixContent()">
                        <i class="fas fa-clapperboard"></i> Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ
                    </button>
                </div>

                <div id="outputSection" style="display: none; margin-top: 30px;">
                    
                    <div id="insightBox" class="cyber-card debug-card" style="display:none;">
                         <p id="insightText"></p>
                    </div>

                    <div class="output-grid" id="mainOutputGrid">
                        <div class="image-frame" id="mainImageContainer"></div>
                        
                        <div class="content-wrapper">
                            <div class="tabs-header">
                                <button class="tab-btn active" onclick="openTab('linkedin')"><i class="fab fa-linkedin"></i> LinkedIn</button>
                                <button class="tab-btn" onclick="openTab('twitter')"><i class="fab fa-twitter"></i> X Thread</button>
                                <button class="tab-btn video-tab-btn" onclick="openTab('tiktok')"><i class="fab fa-tiktok"></i> TikTok Storyboard</button>
                            </div>

                            <div class="cyber-card text-frame">
                                
                                <div id="linkedinContent" class="tab-content active simple-text-content"></div>
                                <div id="twitterContent" class="tab-content simple-text-content"></div>

                                <div id="tiktokContent" class="tab-content cinema-mode">
                                    
                                    <h4 class="section-title"><i class="fas fa-images"></i> Ø§Ù„Ù‚ØµØ© Ø§Ù„Ù…ØµÙˆØ±Ø© (Storyboard Scenes)</h4>
                                    <div class="storyboard-grid" id="storyboardGrid">
                                        <div class="story-frame" id="storyImg1"><div class="loader-ui small">Scene 1</div></div>
                                        <div class="story-frame" id="storyImg2"><div class="loader-ui small">Scene 2</div></div>
                                        <div class="story-frame" id="storyImg3"><div class="loader-ui small">Scene 3</div></div>
                                    </div>

                                    <h4 class="section-title" style="margin-top:25px;"><i class="fas fa-terminal"></i> ÙƒÙˆØ¯ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</h4>
                                    <div class="video-prompt-box">
                                        <textarea id="videoPromptText" readonly></textarea>
                                        <button class="copy-prompt-btn" onclick="copyVideoPrompt()"><i class="fas fa-copy"></i> Ù†Ø³Ø®</button>
                                    </div>

                                    <h4 class="section-title" style="margin-top:25px;"><i class="fas fa-file-alt"></i> Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù†ØµÙŠ</h4>
                                    <div id="tiktokScriptText" class="script-container"></div>
                                </div>

                                <div class="action-bar-bottom">
                                    <span id="platformLabel" class="tech-label">>_ READY.</span>
                                    <button class="cyber-btn-small copy-main-btn" onclick="copyActiveText()"><i class="fas fa-copy"></i> Ù†Ø³Ø® Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†ØµÙŠ</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </main>
    </div>

    <script>
        let currentData = null;

        function openTab(platform) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(platform + 'Content').classList.add('active');
            
            const btnIndex = platform === 'linkedin' ? 0 : platform === 'twitter' ? 1 : 2;
            document.querySelectorAll('.tab-btn')[btnIndex].classList.add('active');

            const mainGrid = document.getElementById('mainOutputGrid');
            const mainImage = document.getElementById('mainImageContainer');
            
            if (platform === 'tiktok') {
                mainImage.style.display = 'none';
                mainGrid.style.gridTemplateColumns = '1fr'; 
                document.getElementById('platformLabel').innerText = '>_ STORYBOARD_MODE_ACTIVE';
            } else {
                mainImage.style.display = 'flex';
                mainGrid.style.gridTemplateColumns = '1fr 1fr'; 
                const label = platform === 'linkedin' ? 'LINKEDIN_POST.TXT' : 'X_THREAD.TXT';
                document.getElementById('platformLabel').innerText = '>_ ' + label;
            }
        }

        async function analyzeStyle() {
            const text = document.getElementById('sampleText').value;
            const status = document.getElementById('styleStatus');
            status.innerText = "SCANNING...";
            try {
                const res = await fetch('/analyze-style', {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({text})});
                const data = await res.json();
                if(data.style_dna) document.getElementById('styleDNA').value = data.style_dna;
                status.innerHTML = "[âœ”] DNA LOCKED";
            } catch(e) { status.innerText = "ERROR"; }
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© (Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ©)
        function loadImage(containerId, prompt, seedOffset) {
            const container = document.getElementById(containerId);
            container.innerHTML = '<div class="loader-ui small"><i class="fas fa-circle-notch fa-spin"></i></div>';
            
            const seed = Math.floor(Math.random() * 10000) + seedOffset;
            const imgUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?nologin=true&width=1024&height=1024&model=flux&seed=${seed}`;

            const img = new Image();
            img.crossOrigin = "Anonymous"; 
            img.src = imgUrl;
            
            img.onload = () => { 
                container.innerHTML = ''; 
                container.appendChild(img);
                
                // Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                const overlay = document.createElement('div');
                overlay.className = 'image-overlay';
                overlay.innerHTML = `
                    <button onclick="downloadImage('${imgUrl}')" title="ØªØ­Ù…ÙŠÙ„"><i class="fas fa-download"></i></button>
                    <button onclick="shareImage('${imgUrl}')" title="Ù…Ø´Ø§Ø±ÙƒØ©"><i class="fas fa-share-alt"></i></button>
                `;
                container.appendChild(overlay);
            };
            
            img.onerror = () => { 
                container.innerHTML = `
                    <div class="retry-box">
                        <span style="color:var(--neon-red);font-size:0.8rem;">ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„</span>
                        <button onclick="loadImage('${containerId}', '${prompt.replace(/'/g, "\\'")}', ${seedOffset + 1})" class="retry-btn">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                `; 
            };
        }

        async function downloadImage(url) {
            try {
                const response = await fetch(url);
                const blob = await response.blob();
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = "AI-Dominator-" + Date.now() + ".jpg";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (error) { window.open(url, '_blank'); }
        }

        async function shareImage(url) {
            if (navigator.share) {
                try { await navigator.share({ title: 'AI Dominator Art', text: 'ØªÙ… Ø§Ù„ØªØµÙ…ÙŠÙ… Ø¨ÙˆØ§Ø³Ø·Ø© AI Dominator ğŸš€', url: url }); } catch (err) {}
            } else {
                navigator.clipboard.writeText(url);
                alert("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©!");
            }
        }

        // Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø·Ø¹ - Timeout Handler)
        async function remixContent() {
            const text = document.getElementById('inputText').value;
            const style = document.getElementById('styleDNA').value;
            const imageStyle = document.getElementById('imageStyle').value;
            const btn = document.getElementById('generateBtn');

            if(!text) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
            
            btn.innerHTML = '<i class="fas fa-film fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ (Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø¯Ù‚ÙŠÙ‚Ø©)...';
            btn.disabled = true;
            document.getElementById('outputSection').style.display = 'block';
            
            document.getElementById('linkedinContent').innerHTML = '<div class="loader-ui">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙƒØªØ§Ø¨Ø©...</div>';
            document.getElementById('twitterContent').innerHTML = '';
            document.getElementById('tiktokScriptText').innerHTML = '';
            document.getElementById('videoPromptText').value = 'Generating...';
            document.getElementById('mainImageContainer').innerHTML = '<div class="loader-ui"><i class="fas fa-spinner fa-spin"></i><br>RENDERING...</div>';
            document.getElementById('storyboardGrid').innerHTML = '';

            // Ù…Ø¤Ù‚Øª Ø­Ù…Ø§ÙŠØ© Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 90000); // 90 Ø«Ø§Ù†ÙŠØ©

            try {
                const res = await fetch('/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text: text, style: style, image_style: imageStyle}),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId); // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª Ø¥Ø°Ø§ Ù†Ø¬Ø­
                
                if (!res.ok) throw new Error("Server Error");
                
                currentData = await res.json();

                if(!currentData.error) {
                    document.getElementById('linkedinContent').innerHTML = currentData.linkedin.replace(/\n/g, '<br>');
                    document.getElementById('twitterContent').innerHTML = currentData.twitter.replace(/\n/g, '<br>');
                    document.getElementById('tiktokScriptText').innerHTML = currentData.tiktok.replace(/\n/g, '<br>');
                    document.getElementById('videoPromptText').value = currentData.video_prompt;
                    
                    if(currentData.debug) {
                        document.getElementById('insightBox').style.display = 'block';
                        document.getElementById('insightText').innerText = currentData.debug;
                    }

                    document.getElementById('storyboardGrid').innerHTML = `
                        <div class="story-frame" id="storyImg1"><div class="loader-ui small">Scene 1</div></div>
                        <div class="story-frame" id="storyImg2"><div class="loader-ui small">Scene 2</div></div>
                        <div class="story-frame" id="storyImg3"><div class="loader-ui small">Scene 3</div></div>
                    `;
                    
                    // ØªØ­Ù…ÙŠÙ„ Ù…ØªØªØ§Ø¨Ø¹ Ù„Ù„ØµÙˆØ±
                    loadImage('mainImageContainer', currentData.image_main, 1);
                    setTimeout(() => { loadImage('storyImg1', currentData.story_img1, 10); }, 1500);
                    setTimeout(() => { loadImage('storyImg2', currentData.story_img2, 20); }, 3000);
                    setTimeout(() => { loadImage('storyImg3', currentData.story_img3, 30); }, 4500);
                } else { throw new Error(currentData.error); }

            } catch(e) { 
                let msg = "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹.";
                if (e.name === 'AbortError') msg = "â±ï¸ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‡Ù„Ø©! Ø§Ù„Ø³ÙŠØ±ÙØ± Ù…Ø¶ØºÙˆØ· Ø¬Ø¯Ø§Ù‹. ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¯ÙŠÙ„ Start Command ÙÙŠ Render Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙˆÙ‚Øª.";
                else msg = "Ø®Ø·Ø£: " + e.message;
                
                alert(msg);
                document.getElementById('linkedinContent').innerHTML = `<div style="color:red;text-align:center;padding:20px;">${msg}</div>`;
            }
            
            btn.innerHTML = '<i class="fas fa-clapperboard"></i> Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ';
            btn.disabled = false;
            openTab('linkedin');
        }

        function copyActiveText() {
            let textToCopy = "";
            if(document.getElementById('linkedinContent').classList.contains('active')) {
                textToCopy = document.getElementById('linkedinContent').innerText;
            } else if(document.getElementById('twitterContent').classList.contains('active')) {
                textToCopy = document.getElementById('twitterContent').innerText;
            } else if(document.getElementById('tiktokContent').classList.contains('active')) {
                textToCopy = document.getElementById('tiktokScriptText').innerText;
            }
            navigator.clipboard.writeText(textToCopy);
            alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ!");
        }

        function copyVideoPrompt() {
            const promptText = document.getElementById('videoPromptText');
            promptText.select();
            document.execCommand("copy");
            alert("ØªÙ… Ø§Ù„Ù†Ø³Ø®!");
        }
    </script>
</body>
</html>
