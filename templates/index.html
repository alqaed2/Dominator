<!-- Ø§Ø³ØªØ¨Ø¯Ù„ Ù‚Ø³Ù… Ø§Ù„Ù€ Script ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ù„Ù Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø­ØµÙ† -->
<script>
    let lastAlchemyResult = null;

    async function triggerDiscovery() {
        const niche = document.getElementById('niche').value;
        const btn = document.querySelector('.alchemy-radar button');
        const status = document.getElementById('alchemyStatus');
        
        btn.innerHTML = '<i class="fas fa-atom fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ù„Ø§Øµ Ø§Ù„Ø¬ÙŠÙ†Ø§Øª...';
        status.innerHTML = '<span class="status-dot-pulse"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ...';
        
        try {
            const res = await fetch('/alchemy/discover', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({niche: niche})
            });
            lastAlchemyResult = await res.json();
            
            document.getElementById('goldSuggestions').innerHTML = `
                <div class="suggestion-item" style="animation: slideIn 0.5s ease-out;">
                    <span>ğŸŒŸ ÙØ±ØµØ© Ù‡ÙŠÙ…Ù†Ø© ÙÙŠ: ${niche}</span>
                    <button onclick="openAlchemyModal()" class="cyber-btn-small">ÙØªØ­ Ø§Ù„Ù…Ø®ØªØ¨Ø±</button>
                </div>`;
            status.innerHTML = "âœ… ØªÙ… ØªØ®Ù„ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø§Ù„Ø®Ø§Ø±Ù‚ Ø¨Ù†Ø¬Ø§Ø­!";
        } catch (e) {
            status.innerHTML = "âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø±Ø§Ø¯Ø§Ø±.";
        }
        btn.innerHTML = 'Ø§ÙƒØªØ´Ø§Ù Ø§Ù„ÙØ±Øµ Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©';
    }

    function openAlchemyModal() {
        if(!lastAlchemyResult) return;
        const modal = document.getElementById('superPostModal');
        const content = document.getElementById('superPostContent');
        const sourceGrid = document.getElementById('sourcePosts');
        
        modal.style.display = 'flex';
        content.innerText = lastAlchemyResult.super_post;
        
        // Ø¨Ù†Ø§Ø¡ Ø´Ø¨ÙƒØ© Ø§Ù„Ø¬ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ù„ØµØ© Ø¨Ø¯Ù‚Ø©
        let html = "";
        lastAlchemyResult.sources.forEach(s => {
            html += `
                <div class="source-item" style="border-right: 3px solid var(--neon-red);">
                    <div style="color:var(--neon-blue); font-weight:800; margin-bottom:5px;">
                        <i class="fab fa-twitter"></i> ØªÙØ§Ø¹Ù„: ${s.engagement}
                    </div>
                    <p style="margin:0; opacity:0.9;">${s.text.substring(0,120)}...</p>
                </div>`;
        });
        sourceGrid.innerHTML = html;
    }

    function closeModal() { document.getElementById('superPostModal').style.display = 'none'; }
    function useAsIdea() {
        document.getElementById('inputText').value = document.getElementById('superPostContent').innerText;
        closeModal();
        alert("ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø§Ù„Ø®Ø§Ø±Ù‚ Ø¥Ù„Ù‰ Ù…Ø­Ø±Ùƒ Ø§Ù„Ù‡ÙŠÙ…Ù†Ø©.");
    }

    // Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙˆÙ„ÙŠØ¯ (Generate)
    async function startDominanceEngine() {
        const idea = document.getElementById('inputText').value;
        if(!idea) return alert("Ø£Ø¯Ø®Ù„ ÙÙƒØ±Ø© Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø§Ù„Ø®Ø§Ø±Ù‚");

        document.getElementById('outputSection').style.display = 'block';
        document.getElementById('engineStatus').innerText = "ğŸ§  Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ...";
        
        for(let p of ['linkedin', 'twitter', 'tiktok']) {
            const el = document.getElementById(p+'Content') || document.getElementById(p+'ScriptText');
            if(el) el.innerHTML = '<i class="fas fa-sync fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰...';
            
            try {
                const res = await fetch('/generate/'+p, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text: idea})
                });
                const data = await res.json();
                
                if(p === 'tiktok') {
                    document.getElementById('tiktokScriptText').innerText = data.text;
                    let vHtml = "";
                    data.video_prompt.forEach(v => {
                        vHtml += `### Scene ${v.time}:\n\`\`\`text\n${v.prompt}\n\`\`\`\n\n`;
                    });
                    document.getElementById('videoPromptText').innerText = vHtml;
                } else {
                    document.getElementById(p+'Content').innerText = data.text;
                }
                document.getElementById('wpilTrace').innerText = data.trace;
            } catch(e) { }
        }
        document.getElementById('engineStatus').innerText = "âœ… ØªÙ… Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ Ù„Ù„Ù…Ù†ØµØ§Øª";
    }
</script>
