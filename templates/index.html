<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI DOMINATOR | WPIL Enabled</title>

  <link rel="stylesheet" href="/static/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
</head>

<body>
  <div class="app-container">
    <header class="cyber-header">
      <div class="logo-section">
        <h1>AI DOMINATOR <span class="version-tag">WPIL + SIC</span></h1>
      </div>
      <div class="system-status"><div class="status-dot"></div>ONLINE</div>
    </header>

    <main class="dashboard-grid">

      <!-- SIDEBAR -->
      <div class="sidebar">
        <div class="cyber-card">
          <div class="card-title"><h3><i class="fas fa-fingerprint"></i> Ø§Ù„Ø£Ø³Ù„ÙˆØ¨</h3></div>
          <textarea id="sampleText" rows="3" placeholder="Ø§Ù„ØµÙ‚ Ù†ØµÙ‹Ø§ ÙŠÙ…Ø«Ù‘Ù„ Ø£Ø³Ù„ÙˆØ¨Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)â€¦"></textarea>
          <button onclick="analyzeStyle()" class="cyber-btn-small">ØªØ­Ù„ÙŠÙ„ (Ø´ÙƒÙ„ÙŠ)</button>
          <input type="hidden" id="styleDNA" value="Professional">
          <div style="margin-top:10px; font-size: 12px; opacity: .85;">
            Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ: <b id="styleLabel">Professional</b>
          </div>
        </div>

        <div class="cyber-card" style="margin-top: 18px;">
          <div class="card-title"><h3><i class="fas fa-sliders-h"></i> Ø§Ù„ØµÙˆØ±</h3></div>
          <select id="imageStyle">
            <option value="Cyberpunk">ğŸ”® Ø³Ø§ÙŠØ¨Ø± Ø¨Ø§Ù†Ùƒ</option>
            <option value="Cinematic" selected>ğŸ“¸ Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ</option>
            <option value="3D Render">ğŸ§Š 3D</option>
          </select>
        </div>

        <div class="cyber-card" style="margin-top: 18px;">
          <div class="card-title"><h3><i class="fas fa-trophy"></i> Winning Posts (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h3></div>

          <label style="display:block; margin-bottom:6px; font-size:12px; opacity:.9;">
            Ø§Ù„Ù†ÙŠØ´ (Ù…Ø«Ø§Ù„: Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©ØŒ Ø§Ù„Ø¹Ù‚Ø§Ø±ØŒ fintech)
          </label>
          <input id="niche" style="width:100%; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,.1); background:rgba(0,0,0,.25); color:#fff;"
                 placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©" value="Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©" />

          <label style="display:block; margin:12px 0 6px; font-size:12px; opacity:.9;">
            Ø§Ù„ØµÙ‚ Ù…Ù†Ø´ÙˆØ±Ù‹Ø§ Ù†Ø§Ø¬Ø­Ù‹Ø§ (Winning Post) Ù„Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø²Ø¬Ù‡
          </label>
          <textarea id="winningPost" rows="6" placeholder="Ø§Ù„ØµÙ‚ Ù‡Ù†Ø§ Ù…Ù†Ø´ÙˆØ±Ù‹Ø§ Ù†Ø§Ø¬Ø­Ù‹Ø§ Ù…Ù† LinkedIn/Xâ€¦ (30 Ø­Ø±ÙÙ‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)"></textarea>

          <div style="margin-top:10px; font-size:12px; opacity:.85;">
            Ø¥Ø°Ø§ ØªØ±ÙƒØªÙ‡Ø§ ÙØ§Ø±ØºØ© â†’ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨ÙˆØ¶Ø¹ â€œÙÙƒØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©â€.
          </div>
        </div>
      </div>

      <!-- MAIN -->
      <div class="main-content">
        <div class="cyber-card">
          <div class="card-title"><h3><i class="fas fa-bolt"></i> Ù…Ø­Ø±Ùƒ Ø§Ù„Ù‡ÙŠÙ…Ù†Ø©</h3></div>

          <textarea id="inputText" rows="3" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙÙƒØ±Ø© (Ø£Ùˆ Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù†Ù‹Ø§/Ù…Ø´ÙƒÙ„Ø©)â€¦"></textarea>

          <button id="generateBtn" class="cyber-btn-main" onclick="startDominanceEngine()">
            <i class="fas fa-rocket"></i> Ø¥Ø·Ù„Ø§Ù‚
          </button>

          <div id="engineStatus" style="margin-top:12px; font-size:12px; opacity:.85;"></div>
        </div>

        <!-- OUTPUT -->
        <div id="outputSection" style="display:none; margin-top: 22px;">
          <div class="output-grid" id="mainOutputGrid">
            <div class="image-area">
              <div class="image-frame" id="mainImageContainer"></div>
              <div class="image-frame" id="tiktokImageContainer" style="display:none; border-color:var(--neon-red);"></div>
            </div>

            <div class="content-wrapper">
              <div class="tabs-header">
                <button class="tab-btn active" onclick="openTab('linkedin')"><i class="fab fa-linkedin"></i> LinkedIn</button>
                <button class="tab-btn" onclick="openTab('twitter')"><i class="fab fa-twitter"></i> X</button>
                <button class="tab-btn video-tab-btn" onclick="openTab('tiktok')"><i class="fab fa-tiktok"></i> TikTok</button>
              </div>

              <div class="cyber-card text-frame">
                <div id="linkedinContent" class="tab-content active simple-text-content"></div>
                <div id="twitterContent" class="tab-content simple-text-content"></div>

                <div id="tiktokContent" class="tab-content cinema-mode">
                  <h4 class="section-title"><i class="fas fa-terminal"></i> Video Prompt</h4>
                  <div class="video-prompt-box">
                    <textarea id="videoPromptText" readonly></textarea>
                    <button class="copy-prompt-btn" onclick="copyPrompt()"><i class="fas fa-copy"></i></button>
                  </div>

                  <h4 class="section-title"><i class="fas fa-file-alt"></i> Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª</h4>
                  <div id="tiktokScriptText" class="script-container"></div>
                </div>
              </div>

              <div class="cyber-card" style="margin-top:14px;">
                <div class="card-title">
                  <h3><i class="fas fa-brain"></i> WPIL Trace (Ù„Ù„ØªØ­Ù‚Ù‚)</h3>
                </div>
                <div style="font-family:'JetBrains Mono', monospace; font-size:12px; opacity:.9; white-space:pre-wrap;" id="wpilTrace">
Ø¬Ø§Ù‡Ø².
- Ø¥Ø°Ø§ Ø£Ø¯Ø®Ù„Øª Winning Post: Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ (Remixed Seed + SIC Final Input).
- Ø¥Ø°Ø§ Ù„Ù… ØªÙØ¯Ø®Ù„: Ø³ÙŠØ¸Ù‡Ø± â€œDirect Modeâ€.
                </div>
              </div>

            </div>
          </div>
        </div>

      </div>
    </main>
  </div>

  <script>
    function openTab(platform) {
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));

      document.getElementById(platform + 'Content').classList.add('active');

      const btnIndex = platform === 'linkedin' ? 0 : platform === 'twitter' ? 1 : 2;
      document.querySelectorAll('.tab-btn')[btnIndex].classList.add('active');

      const mainImg = document.getElementById('mainImageContainer');
      const tiktokImg = document.getElementById('tiktokImageContainer');

      if (platform === 'tiktok') {
        mainImg.style.display = 'none';
        tiktokImg.style.display = 'flex';
      } else {
        mainImg.style.display = 'flex';
        tiktokImg.style.display = 'none';
      }
    }

    function loadImage(containerId, prompt) {
      const el = document.getElementById(containerId);
      if(!prompt || prompt.length < 5) { el.innerHTML = ''; return; }

      el.innerHTML = '<div class="loader-ui small"><i class="fas fa-circle-notch fa-spin"></i></div>';

      const seed = Math.floor(Math.random() * 9999);
      const imgUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?nologin=true&width=1024&height=1024&model=flux&seed=${seed}`;

      const img = new Image();
      img.crossOrigin = "Anonymous";
      img.src = imgUrl;
      img.onload = () => {
        el.innerHTML = '';
        el.appendChild(img);

        const overlay = document.createElement('div');
        overlay.className = 'image-overlay';
        overlay.innerHTML = `<button onclick="window.open('${imgUrl}', '_blank')" title="ØªØ­Ù…ÙŠÙ„"><i class="fas fa-download"></i></button>`;
        el.appendChild(overlay);
      };
      img.onerror = () => { el.innerHTML = '<span style="color:red">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</span>'; };
    }

    async function postJSON(url, payload) {
      const res = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      let data = null;
      try { data = await res.json(); } catch (e) {}

      if (!res.ok) {
        const msg = (data && data.error) ? data.error : `Server Error: ${res.status}`;
        throw new Error(msg);
      }
      return data;
    }

    async function startDominanceEngine() {
      const text = document.getElementById('inputText').value.trim();
      const style = document.getElementById('styleDNA').value || "Professional";
      const imgStyle = document.getElementById('imageStyle').value || "Cinematic";

      const niche = document.getElementById('niche').value.trim() || "general";
      const winningPost = document.getElementById('winningPost').value.trim();

      if(!text && !winningPost) return alert("Ø£Ø¯Ø®Ù„ ÙÙƒØ±Ø© Ø£Ùˆ Ø§Ù„ØµÙ‚ Winning Post");

      const btn = document.getElementById('generateBtn');
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-sync fa-spin"></i> ØªØ´ØºÙŠÙ„...';

      document.getElementById('outputSection').style.display = 'block';
      document.getElementById('engineStatus').innerHTML = 'ğŸ§  ØªØ´ØºÙŠÙ„ WPIL + SIC...';

      // loaders
      document.getElementById('linkedinContent').innerHTML = '<div class="loader-ui">Ø¬Ø§Ø±ÙŠ LinkedIn...</div>';
      document.getElementById('twitterContent').innerHTML  = '<div class="loader-ui">Ø¬Ø§Ø±ÙŠ X...</div>';
      document.getElementById('tiktokScriptText').innerHTML = '<div class="loader-ui">Ø¬Ø§Ø±ÙŠ TikTok...</div>';
      document.getElementById('videoPromptText').value = '';
      document.getElementById('mainImageContainer').innerHTML = '<div class="loader-ui">Image...</div>';
      document.getElementById('tiktokImageContainer').innerHTML = '<div class="loader-ui">Cover...</div>';

      let seedText = text || "ÙÙƒØ±Ø© Ø¹Ø§Ù…Ø©";
      let finalInput = seedText;

      // 1) Ø¥Ø°Ø§ ÙŠÙˆØ¬Ø¯ Winning Post â†’ Ù†Ø¹Ù…Ù„ Remix Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
      if (winningPost && winningPost.length >= 30) {
        try {
          const remix = await postJSON('/remix', {
            winning_post: winningPost,
            niche: niche,
            style_dna: style,
            platform: 'linkedin'
          });

          seedText = remix.remixed_seed || seedText;
          finalInput = remix.sic_transformed_input || seedText;

          document.getElementById('wpilTrace').textContent =
`MODE: WINNING POSTS REMIX
NICHE: ${niche}

REMIXED SEED:
${seedText}

SIC FINAL INPUT:
${finalInput}`;
        } catch (e) {
          document.getElementById('wpilTrace').textContent =
`MODE: WINNING POSTS REMIX
Ù„ÙƒÙ† ÙØ´Ù„ /remix:
${e.message}

Ø³ÙŠØªÙ… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨ÙˆØ¶Ø¹ Direct Mode.`;
          finalInput = seedText;
        }
      } else {
        document.getElementById('wpilTrace').textContent =
`MODE: DIRECT
INPUT:
${finalInput}`;
      }

      // 2) Ù†ÙˆÙ„Ù‘Ø¯ ÙƒÙ„ Ø§Ù„Ù…Ù†ØµØ§Øª Ø¨Ø§Ù„ØªÙˆØ§Ø²ÙŠ Ù…Ù† finalInput
      const payload = { text: finalInput, style_dna: style, image_style: imgStyle };

      try {
        const [li, tw, tk] = await Promise.all([
          postJSON('/generate/linkedin', payload),
          postJSON('/generate/twitter', payload),
          postJSON('/generate/tiktok', payload)
        ]);

        document.getElementById('linkedinContent').innerHTML = (li.text || '').replace(/\n/g,'<br>');
        document.getElementById('twitterContent').innerHTML  = (tw.text || '').replace(/\n/g,'<br>');

        document.getElementById('tiktokScriptText').innerHTML = (tk.text || '').replace(/\n/g,'<br>');
        document.getElementById('videoPromptText').value = tk.video_prompt || '';

        // images
        loadImage('mainImageContainer', li.image);
        loadImage('tiktokImageContainer', tk.image);

        document.getElementById('engineStatus').innerHTML = 'âœ… ØªÙ… Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­ (WPIL + SIC).';
        openTab('linkedin');

      } catch (e) {
        document.getElementById('engineStatus').innerHTML = 'âŒ ÙØ´Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„: ' + e.message;
      }

      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-rocket"></i> Ø¥Ø·Ù„Ø§Ù‚';
    }

    function analyzeStyle() {
      // ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø©: ØªØ­Ù„ÙŠÙ„ Ø´ÙƒÙ„ÙŠ ÙÙ‚Ø·
      const t = document.getElementById('sampleText').value.trim();
      const newStyle = t.length > 20 ? "Personal-Professional" : "Professional";
      document.getElementById('styleDNA').value = newStyle;
      document.getElementById('styleLabel').innerText = newStyle;
      alert("ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø³Ù„ÙˆØ¨: " + newStyle);
    }

    function copyPrompt() {
      const v = document.getElementById('videoPromptText').value || '';
      navigator.clipboard.writeText(v);
      alert("ØªÙ… Ø§Ù„Ù†Ø³Ø®");
    }
  </script>
</body>
</html>
