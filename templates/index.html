<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Dominator | Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">AI Dominator <span class="version" style="background: linear-gradient(45deg, #ff0055, #ff9900);">AGENCY</span></div>
            <p class="subtitle">ÙˆÙƒØ§Ù„ØªÙƒ Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (Ù†Øµ + ØµÙˆØ±Ø©)</p>
        </header>

        <main>
            <div class="identity-section">
                <h3><i class="fas fa-fingerprint"></i> Ø¨ØµÙ…Ø© Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ (DNA)</h3>
                <textarea id="sampleText" placeholder="Ø§Ù„ØµÙ‚ Ø£ÙØ¶Ù„ 3 Ù…Ù†Ø´ÙˆØ±Ø§Øª Ù„Ùƒ Ù‡Ù†Ø§ Ù„Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø£Ø³Ù„ÙˆØ¨Ùƒ..."></textarea>
                <button class="analyze-btn" onclick="analyzeStyle()">ğŸ§¬ Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ DNA</button>
                <div id="styleStatus" class="status-msg"></div>
                <input type="hidden" id="styleDNA" value="">
            </div>

            <div class="generation-section">
                <h3><i class="fas fa-brain"></i> ØºØ±ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©</h3>
                <textarea id="inputText" placeholder="Ø§ÙƒØªØ¨ ÙÙƒØ±Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù‡Ù†Ø§... ÙˆØ³Ù†Ù‚ÙˆÙ… Ø¨ØªØ£Ù„ÙŠÙ Ø§Ù„Ù†Øµ ÙˆØªØµÙ…ÙŠÙ… Ø§Ù„ØµÙˆØ±Ø©."></textarea>
                <button id="generateBtn" onclick="remixContent()">ğŸ¨ğŸš€ Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©</button>
            </div>

            <div class="output-section" id="outputSection" style="display: none;">
                
                <div class="insight-box" id="insightBox" style="display:none;">
                    <h4><i class="fas fa-microscope"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ø§Ù‚Ø¯:</h4>
                    <p id="insightText"></p>
                </div>

                <div class="creative-studio">
                    <div class="image-card">
                        <div class="card-header">âœ¨ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­ØµØ±ÙŠØ© (AI Generated)</div>
                        <div class="image-container" id="imageContainer">
                            <div class="placeholder-image">
                                <i class="fas fa-image fa-3x"></i>
                                <p>Ø¬Ø§Ø±ÙŠ ØªØµÙ…ÙŠÙ… Ø§Ù„ØµÙˆØ±Ø©...</p>
                            </div>
                        </div>
                        <p id="imagePromptHint" class="prompt-hint"></p>
                    </div>

                    <div class="text-card">
                        <div class="card-header">
                            <span>ğŸ“ Ø§Ù„Ù†Øµ Ø§Ù„ÙÙŠØ±ÙˆØ³ÙŠ</span>
                            <button class="icon-btn" onclick="copyText()"><i class="fas fa-copy"></i></button>
                        </div>
                        <div class="result-box" id="resultText"></div>
                    </div>
                </div>

            </div>
        </main>

        <footer>
            <p>Engineered by <strong>Alhothaify Tech</strong> Â© 2025</p>
        </footer>
    </div>

    <script>
        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„Ù†Ø³Ø® (ÙƒÙ…Ø§ Ù‡ÙŠ) ---
        async function analyzeStyle() {
            const text = document.getElementById('sampleText').value;
            const status = document.getElementById('styleStatus');
            if(!text || text.length < 20) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù„ØµÙ‚ Ù†Øµ ÙƒØ§ÙÙ!");
            status.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...';
            status.className = "status-msg processing";
            try {
                const response = await fetch('/analyze-style', {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({text: text})});
                const data = await response.json();
                if(data.style_dna) {
                    document.getElementById('styleDNA').value = data.style_dna;
                    status.innerHTML = 'âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨.';
                    status.className = "status-msg success";
                } else { throw new Error(data.error); }
            } catch (e) { status.innerText = "ÙØ´Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„."; status.className = "status-msg error"; }
        }
        function copyText() { navigator.clipboard.writeText(document.getElementById('resultText').innerText); alert("ØªÙ… Ø§Ù„Ù†Ø³Ø®!"); }

        // --- Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© (ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Øµ + Ø§Ù„ØµÙˆØ±Ø©) ---
        async function remixContent() {
            const text = document.getElementById('inputText').value;
            const style = document.getElementById('styleDNA').value;
            const btn = document.getElementById('generateBtn');
            
            if(!text) return alert("Ø§ÙƒØªØ¨ ÙÙƒØ±Ø©!");

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ù„ØªØ­Ù…ÙŠÙ„
            btn.innerHTML = '<i class="fas fa-palette fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ (Ù†Øµ + ØµÙˆØ±Ø©)...';
            btn.disabled = true;
            document.getElementById('outputSection').style.display = 'block';
            document.getElementById('resultText').innerHTML = '<div class="loader"></div>';
            document.getElementById('imageContainer').innerHTML = '<div class="loader-img"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±Ø³Ù…...</div>';
            document.getElementById('insightBox').style.display = 'none';
            document.getElementById('imagePromptHint').innerText = '';

            try {
                // 1. Ø·Ù„Ø¨ Ø§Ù„Ù†Øµ ÙˆÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text: text, style: style})
                });
                const data = await response.json();

                if(data.error) {
                    document.getElementById('resultText').innerHTML = `<span style="color:red">Ø®Ø·Ø£: ${data.error}</span>`;
                    document.getElementById('imageContainer').innerHTML = '<i class="fas fa-exclamation-triangle"></i> ÙØ´Ù„ Ø§Ù„ØªÙˆÙ„ÙŠØ¯';
                } else {
                    // Ø¹Ø±Ø¶ Ø§Ù„Ù†Øµ
                    document.getElementById('resultText').innerHTML = data.result.replace(/\n/g, '<br>');
                    if(data.debug) {
                        document.getElementById('insightBox').style.display = 'block';
                        document.getElementById('insightText').innerText = data.debug;
                    }

                    // 2. ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø© (Ø§Ù„Ø®Ø¯Ø¹Ø© Ø§Ù„Ø°ÙƒÙŠØ©)
                    // Ù†Ø³ØªØ®Ø¯Ù… ÙˆØµÙ Ø§Ù„Ù…Ø­Ø±Ø± Ù„Ø·Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø®Ø¯Ù…Ø© Ø®Ø§Ø±Ø¬ÙŠØ© Ø³Ø±ÙŠØ¹Ø©
                    const imagePrompt = encodeURIComponent(data.image_prompt);
                    // Ù†Ø³ØªØ®Ø¯Ù… Ø®Ø¯Ù…Ø© pollinations.ai ÙƒÙ…Ø«Ø§Ù„ Ù„Ù„Ø³Ø±Ø¹Ø© ÙˆØ§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© (ØªØ³ØªØ®Ø¯Ù… Flux/SDXL)
                    const imageUrl = `https://image.pollinations.ai/prompt/${imagePrompt}?nologin=true&width=1024&height=1024&model=flux`;
                    
                    const imgElement = new Image();
                    imgElement.onload = function() {
                        document.getElementById('imageContainer').innerHTML = '';
                        document.getElementById('imageContainer').appendChild(imgElement);
                    };
                    imgElement.onerror = function() {
                        document.getElementById('imageContainer').innerHTML = 'âŒ ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©.';
                    };
                    imgElement.src = imageUrl;
                    imgElement.alt = "AI Generated Image";
                    
                    // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø¹Ø±Ø¶ Ø§Ù„ÙˆØµÙ Ø§Ù„Ø°ÙŠ ØªØ®ÙŠÙ„Ù‡ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
                    // document.getElementById('imagePromptHint').innerText = "ğŸ’¡ ØªØ®ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡: " + data.image_prompt.substring(0, 50) + "...";
                }
            } catch (err) {
                document.getElementById('resultText').innerText = "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±.";
            }

            btn.innerHTML = 'ğŸ¨ğŸš€ Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©';
            btn.disabled = false;
        }
    </script>
</body>
</html>
